<!DOCTYPE html>
<html>
    <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <style> 
        .buton{
            width: 5%;
            height:30px;
            min-width: 70px;
            background: cornflowerblue;
        };

        .editbox
        {
            font-size:18pt;
            height:100px;
            width:50px;
        };
    </style>

    <style type="text/css">
        body {background: whitesmoke;text-align: center;}
        button{background-color: darkslategrey;color: white;border: 0;font-size: 18px;font-weight: 500;border-radius: 7px;padding: 5px 5px;cursor: pointer;white-space: nowrap;}        
    </style>

    <script>
        const hLoc="{{.Title}}";
        function newHiddenElement(name,key){
            const hiddenField=document.createElement('input');
            hiddenField.type='hidden';
            hiddenField.name=name;
            hiddenField.id=name;
            hiddenField.value=key;
            return hiddenField;
        }
        function onSave() {
            if(document.getElementById('f')==null)
                document.getElementById('textArea').appendChild(newHiddenElement("f",hLoc));
            else
                document.getElementById('f').value=hLoc;
            if(document.getElementById('p')==null)
                document.getElementById('textArea').appendChild(newHiddenElement("p",(document.getElementById('parola').value)));
            else
                document.getElementById('p').value=document.getElementById('parola').value;
            var form=$('#textArea');
            $.ajax({
                type:"POST",
                url:"/save",
                data:form.serialize(),
                success:function(data){
                    if(data=="ok")
                         toastr.success('File successfully saved');
                    else
                        toastr.error('Wrong password');
                        
                }
            }) ;
            
        }
        function onLock(){
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET","/lock?f="+hLoc+"&p="+document.getElementById('parola').value, false );
            xmlHttp.send( null );
            var response=xmlHttp.responseText;
            toastr.info(response)
        }
        function onUnLock(){
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET","/unlock?f="+hLoc+"&p="+document.getElementById('parola').value, false );
            xmlHttp.send( null );
            var response=xmlHttp.responseText;
            if(response=="Wrong Passowrd")
                toastr.error(response);
            else
                toastr.success(response);
        }
        function onBack(){
            window.location.href="/"
        }
        function onRefresh(){
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET","/refresh?f="+hLoc, false );
            xmlHttp.send( null );
            document.getElementById('textx').value=xmlHttp.responseText;
        }
		$(document).ready(function() {
			toastr.options = {
				'closeButton': true,
				'debug': false,
				'newestOnTop': false,
				'progressBar': false,
				'positionClass': 'toast-top-right',
				'preventDuplicates': false,
				'showDuration': '1000',
				'hideDuration': '1000',
				'timeOut': '5000',
				'extendedTimeOut': '1000',
				'showEasing': 'swing',
				'hideEasing': 'linear',
				'showMethod': 'fadeIn',
				'hideMethod': 'fadeOut',
			}
		});
    </script>
    </head>
    <title>{{.Title}}</title>
    <body onload="onRefresh()">
        <center>
            <div>
                <button type="button" class="buton" id="back" onclick="onBack()">Back</button>
                <button type="button" class="buton" id="refresh" onclick="onRefresh()">Refresh</button>
                <button type="button" class="buton" id="save" onclick="onSave()">Save</button>
                <button type="button" class="buton" id="lock" onclick="onLock()">Lock</button>
                <input type="password" id="parola">
                <button type="button" class="buton" id="unlock" onclick="onUnLock()">Unlock</button>
            </div>
            <br>
        </center>
        <div style="height:80%;width:100%;">
            <form name="textArea" id="textArea" action="/save" method="post">
                <textarea id="textx" name="textx" style="width: 100%;  height: 92vh; "></textarea>
            </form>
        </div>
    </body>
</html>